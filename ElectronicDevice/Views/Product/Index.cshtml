@model ElectronicDevice.Models.Product
@{
    ViewBag.Title = "Sản phẩm";
}

<!--================Home Banner Area =================-->
<!-- breadcrumb start-->
<section class="breadcrumb breadcrumb_bg" id="my_banner">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <div class="breadcrumb_iner">
                    <div class="breadcrumb_iner_item" id="title-banner">
                        <h2>Tất cả sản phẩm</h2>
                        <p>Trang chủ</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="breadcrumb_iner">
                    <div class="breadcrumb_iner_item">
                        <img src="~/wwwroot/img/my-image/banner/product1.png" alt="" width="560">
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- breadcrumb start-->
<!--================Category Product Area =================-->
<section class="cat_product_area mt-3">
    <div class="container bg-white p-4">
        <div class="row">
            <div class="col-lg-3">
                @{
                    Html.RenderAction("_LeftSidebar", "Category");
                }
            </div>
            <div class="col-lg-9">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product_top_bar d-flex justify-content-between align-items-center">
                            @*<div class="single_product_menu">
                                    <p><span id="total-amount-product">@ViewBag.totalProduct </span> sản phẩm</p>
                                </div>*@
                            @*<div class="single_product_menu d-flex">
                                    <h5>Sắp xếp theo : </h5>
                                    <select style="display:none">
                                        <option data-display="none">Không</option>
                                        <option value="1">Giá</option>
                                        <option value="2">Tên</option>
                                    </select>
                                </div>*@
                            <div class="single_product_menu d-flex">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Tìm kiếm"
                                           aria-describedby="inputGroupPrepend" id="searchStr" value="@ViewBag.searchStr">
                                    <div class="input-group-prepend" id="search">
                                        <span class="input-group-text" id="inputGroupPrepend">
                                            <i class="ti-search"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row align-items-center latest_product_inner " id="product-container">


                    @*list product*@


                </div>
                <div class="col-lg-12">
                    <div class="pageination">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-center pagination" id="load-pagination">

                                @*Paged List*@

                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!--alert message-->
<div class="alert hide" id="alert_message">
    <div id="icon-alert-message"><i class="fas fa-exclamation-circle"></i></div>
    <span class="msg">Warning: This is a warning alert!</span>
    <div class="close-btn-alert">
        <span class="fas fa-times"></span>
    </div>
</div>

<!--================End Category Product Area =================-->
<!-- product_list part start-->
@{
    Html.RenderAction("_NewProduct", "Product");
}

@section script{
    <script>
        $(document).ready(function () {

            $('.close-btn-alert').click(function () {
                $('.alert').removeClass("show");
                $('.alert').addClass("hide");
            });

            var load = function (searchStr, page, id_category) {
                $.ajax({
                    url: "/Product/GetAll",
                    type: "GET",
                    data: { searchStr: searchStr, page: page, id_category:id_category },
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function (result) {
                        var html = '';
                        var imgPath = '';
                        var id_account = '@Request.RequestContext.HttpContext.Session["ID"]';
                        $.each(result.data, function (index, item) {
                            imgPath = '/wwwroot/imageUpload/' + item.Image;
                            /*onclick = "detail(' + item.ID_Product+')"*/
                            html += '<div class="col-lg-4 col-sm-6 box-single-product" onclick = "detail(' + item.ID_Product +')">';
                            html += '<div class="single_product_item">';
                            html += '<img class="img-product" src="' + imgPath + '"  alt="">';
                            html += '<div class="single_product_text">';
                            html += '<h4>' + item.Name + '</h4>';
                            html += '<h3>' + item.Price.toLocaleString('it-IT', { style: 'currency', currency: 'VND' }) + '</h3>';
                            html += '<div class="my-cart border rounded-circle" title="Thêm sản phẩm vào giỏ" onclick="event.stopPropagation();addProductToCart(' + item.ID_Product +','+id_account+')">';
                            html += '<i class="fas fa-shopping-cart"></i>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            html += ' </div>';

                            //create pagination
                            var pagination_string = "";
                            var currentPage = result.currentPage;
                            var totalPage = result.totalPage;


                           if (currentPage > 1) {
                                var previousPage = currentPage - 1;
                               pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + previousPage + '><i class="fas fa-angle-double-left" style="font-size:18px"></i></a></li>';
                            }

                            for (i = 1; i <= totalPage; i++) {
                                if (i == currentPage) {
                                    pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + currentPage + '</a></li>';
                                } else {
                                    pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                                }
                            }

                            if (currentPage > 0 && currentPage < totalPage) {
                                var nextPage = currentPage + 1;
                                pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + nextPage + '><i class="fas fa-angle-double-right" style="font-size:18px"></i></a></li>';
                            }
                            $("#load-pagination").html(pagination_string);
                        });
                        $("#product-container").html(html);
                    }

                });
            }

            $('.row-left-sidebar').click(function () {
                $('#searchStr').val("");
                $('.table-categoty').find('.chosed').removeClass('chosed');
                var id_category = $(this).attr('id');
                load(null, 1, id_category);
                $(this).addClass('chosed');
                var title = $(this).children('td:nth-child(2)').text();
                $('#title-banner').find('h2').html("Danh mục sản phẩm");
                $('#title-banner').find('p').html("Trang chủ > " + title);
            });

            $("body").on("click", ".pagination li a", function (event) {
                event.preventDefault();
                var page = $(this).attr('data-page');
                var id_category = $('.table-categoty').find('.chosed').attr('id');
                //load event pagination
                var txtSearch = $("#searchStr").val();
                if (txtSearch != "") {
                    load(txtSearch, page, id_category);
                }
                else {
                    load(null, page, id_category);
                }

            });

            $("#search").click(function () {
                var txtSearch = $("#searchStr").val();
                if (txtSearch != "") {
                    load(txtSearch, 1, null);
                }
                else {
                    load(null, 1, null);
                }
            });

            //load init
            load(null, 1, null);
        });

        function detail(id_product) {
            /*window.location.href =*/
            var url = '@Url.Action("Detail", "Product", new { id_product = "__id__" })';
            window.location.href = url.replace('__id__', id_product);
        };

        function addProductToCart(id_product, id_account) {
            if (id_account == null) {
                var url = '@Url.Action("Index","Login",new { statusRequest="LoginToCart"})';
                window.location.href = url;
            } else {
                $.ajax({
                    url: "/cart/addcart",
                    type: "post",
                    data: { id_product: id_product, id_account:id_account },
                    datatype: "json",
                    contenttype: "application/json;charset=utf-8",
                    success: function (result) {
                        showAlertMessage(result.data, true);
                    },
                    error: (error) => {
                        showAlertMessage("Không thể thêm vào giỏ hàng sản phẩm này!", false);
                    }
                });
            }
        }

        function showAlertMessage(message, messageState) {
            if (messageState) {
                $('#alert_message').css({ "background": "#C5F3D7", "border-left": "8px solid #2BD971" });
                $("#icon-alert-message").html('<i class="fas fa-check-circle"></i>');
                $("#icon-alert-message").find('i').css({ "color": "#2BD971" });
                $(".msg").css({ "color": "#24AD5F"});
                $(".close-btn-alert").css({ "background": "#2BD971", "color": "#24AD5F" });
                $(".close-btn-alert").find('.fas').css({ "color": "#24AD5F" });
                $(".close-btn-alert").hover(function (e) {
                    $(this).css("background-color", e.type === "mouseenter" ? "#38F5A3" : "#2BD971")
                })
            } else {
                $('#alert_message').css({ "background": "#FFE1E3", "border-left": "8px solid #FF4456" });
                $("#icon-alert-message").html('<i class="fas fa-exclamation-circle"></i>');
                $("#icon-alert-message").find('i').css({ "color": "#FE4950" });
                $(".msg").css({ "color": "#F694A9" });
                $(".close-btn-alert").css({ "background": "#FF9CA4", "color": "#FD4653" });
                $(".close-btn-alert").find('.fas').css({ "color": "#FD4653" });
                $(".close-btn-alert").hover(function (e) {
                    $(this).css("background-color", e.type === "mouseenter" ? "#FFBDC2" : "#FF9CA4")
                })
            }

            $('.msg').text(message);
            $('.alert').addClass("show");
            $('.alert').removeClass("hide");
            $('.alert').addClass("showAlert");
            setTimeout(function () {
                $('.alert').removeClass("show");
                $('.alert').addClass("hide");
            }, 3000);
        };


    </script>
}


